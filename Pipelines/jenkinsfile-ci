node("slave-agent"){
    
    def imageTag="davidmason99109/kubernetes-project:${BUILD_NUMBER}"
    def codeDest="app"
    def gitRepo="git@github.com:Jamesfranklin99/beginner-html-site-styled.git"
    def gitBranch="gh-pages"
    def gitCreds="github"
    
    stage('Clone Repository') {
        sh "mkdir -p app"
        dir(codeDest) {
            git url: "${gitRepo}", branch: "${gitBranch}", credentialsId: "${gitCreds}"
        }
    }
    
    stage("Docker build Image"){
        sh "sudo docker build -t ${imageTag} app"
    }
    
    stage("Docker Push Image"){
        sh "sudo docker push ${imageTag}"
    }

    stage('Trigger CD Job') {
        build job: 'Application-Pipeline-CI', 
              parameters: [
                  string(name: 'ImageTag', value: '${imageTag}')
              ], 
              wait: false
    }
    
}